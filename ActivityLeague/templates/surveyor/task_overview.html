{% extends 'base.html' %}

{% block sidebar %}
<li class="nav-item">
  <a class="nav-link active" href="{% url 'dashboard' %}">
    <span data-feather="home"></span>
    Dashboard <span class="sr-only">(current)</span>
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="{% url 'leaderboard' %}">
    <span data-feather="award"></span>
    Leaderboard
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="{% url 'groups' %}">
    <span data-feather="bar-chart-2"></span>
    Groups <span class="sr-only">(current)</span>
  </a>
</li>
{% endblock %}
        
{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
  <h1 class="h2">Task Overview: {{task}}</h1>
</div>

<!-- Info Cards -->
<div class="card-deck justify-content-center m-5 rounded">
  <div class="col-auto">
    <div class="card text-center border ml-5 mr-5 h-100" style="width: 18rem;">
      <div class="card-header"><b>Total Respondents</b></div>
      <div class="card-body">
        <p class="card-text text-primary" style="font-size: 200%;"><b>{{task_total_respondents}}</b></p>
      </div>
    </div>
  </div>
  <div class="col-auto">
    <div class="card text-center border ml-5 mr-5 h-100" style="width: 18rem;">
      <div class="card-header"><b>Respondents Completed</b></div>
      <div class="card-body">
        <p class="card-text text-primary" style="font-size: 200%;"><b>{{task_respondents_completed}}</b></p>
      </div>
    </div>
  </div>
  <div class="col-auto">
    <div class="card text-center border ml-5 mr-5 h-100" style="width: 18rem;">
      <div class="card-header"><b>Due Date</b></div>
      <div class="card-body">
        <p class="card-text text-primary" style="font-size: 200%;"><b>{{task.due_date}}</b></p>
      </div>
    </div>
  </div>
</div>

<!-- Responses Section -->
<div class="m-5 rounded align-right" align="right">
  <button id="toggleAccordions-show" class="btn btn-secondary" type="button" data-toggle="collapse">Expand all</button>
  <button id="toggleAccordions-hide" class="btn btn-secondary" type="button" data-toggle="collapse">Collapse all</button>
</div>

<div class="border m-5 rounded bg-light" id="responses-container">
<div id="accordion" class="accordion">
    {% for question in questions %}
    <div id="{{ question.id }}" class="card">
      <div class="card-header clickable-header d-flex justify-content-between align-items-center" id="{{ question.id }}_heading" data-toggle="collapse" data-target="#{{ question.id }}_collapse" aria-expanded="false" aria-controls="{{ question.id }}_collapse">
          <button class="btn btn-link collapsed">{{ question.description }}</button>
          {% if question.link %}
              <a class="text-muted"> Link clicked {{question.link_clicks}} times</a>
          {% endif %}
      </div>

      <div id="{{ question.id }}_collapse" class="collapse" aria-labelledby="{{ question.id }}_heading">
        <div class="card-body p-5" align="center">
          {% if task_respondents_completed %}
            {% if question.type == 'text' %}
              <div id="{{ question.id }}_cloud"></div>
            {% else %}
              <canvas id="{{ question.id }}_canvas"></canvas>
            {% endif %}
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
<script>
$(function() {
    $('#toggleAccordions-show').on('click', function(e) {
        $('#accordion .collapse').collapse('show');
    })
    $('#toggleAccordions-hide').on('click', function(e) {
        $('#accordion .collapse').collapse('hide');
    })
});
</script>
{% for question in questions %}
  {% if question.type == 'text' %}
  <script>
    var ctx = document.getElementById("{{ question.id }}_cloud");
    img = document.createElement('img');
    img.src = "{{ question.word_cloud }}";
    img.style.width = "25%";
    img.style.height = "auto";
    ctx.appendChild(img);
  </script>
  {% else %}
  <script>
    var ctx = document.getElementById("{{ question.id }}_canvas").getContext('2d');
    new Chart (ctx, {
      type: 'pie',
      data: {
        datasets: [{
          data: {{ question.pie_chart_data | safe}},
          backgroundColor: [
            'red', 'blue', 'pink', 'orange', 'green'
          ]
        }],
        labels: {{ question.pie_chart_labels | safe}},
      },
      options: {
        legend: {
          display: true,
          position: 'bottom',
          align: 'center'
        }
      }
    });
  </script>
  {% endif %}
{% endfor %}
{% endblock %}
