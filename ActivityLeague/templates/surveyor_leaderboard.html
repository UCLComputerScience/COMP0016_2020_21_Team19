{% extends 'base.html' %}

{% block sidebar %}
<li class="nav-item">
  <a class="nav-link" href="{% url 'surveyor_dashboard' user.pk %}">
    <span data-feather="home"></span>
    Dashboard
  </a>
</li>
<li class="nav-item">
  <a class="nav-link active" href="#">
    <span data-feather="bar-chart-2"></span>
    Leaderboard <span class="sr-only">(current)</span>
  </a>
</li>
{% endblock %}

{% block content %}
<h2>Leaderboard</h2>
<div class="btn-group pt-3 mb-4" role="group">
  <!-- Button Group Here for the classes -->
  <button type="button" class="btn btn-primary mr-2 rounded">Ankle Sprain 1</button>
  <button type="button" class="btn mr-2 rounded">Ankle Sprain 2</button>
  <button type="button" class="btn mr-2 rounded">Dislocated Shoulder</button>
</div>
<div> {# class="container" #}
  <table class="table table-striped table-hover">
      <thead class="thead">
      <tr>
          <th>Rank</th>
          <th>Name</th>
          <th>Score</th>
      </tr>
      </thead>
      <tbody id="table-body">
      </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
<script>
  var pk = {{ pk }};

  function add_row (parent, rank, name, score) {
    var row_wrapper = document.createElement('tr');

    var name_wrapper = document.createElement('td');
    var score_wrapper = document.createElement('td');
    var rank_wrapper = document.createElement('td');

    rank_wrapper.textContent = rank;
    name_wrapper.textContent = name;
    score_wrapper.textContent = score;

    var new_elements = [];
    new_elements.push(rank_wrapper, name_wrapper, score_wrapper);
    
    for (var i = 0; i < new_elements.length; i++) {
      row_wrapper.appendChild(new_elements[i]);
    }
    parent.appendChild(row_wrapper);
  }

  function render_leaderboard () {
    $.get('/surveyor@' + pk + '/get_leaderboard_json', function (leaderboardData) {
      var parent = document.getElementById('table-body');

      var rows = leaderboardData['rows'];
      for (var i=0; i < rows.length; i++) {
        var row = rows[i];
        add_row(parent, i + 1, row['name'], row['score']);
      }
    });
  }

  $(function () {
    render_leaderboard();
  });

</script>
{% endblock %}